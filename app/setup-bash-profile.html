<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>synle/bashrc Setting up Bash Script</title>
    <style>
      html {
        font-family: monospace !important;
        font-size: 18px;
        padding: 10px 20px;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      #output {
        width: 100%;
        height: 300px;
      }
      div {
        margin-bottom: 20px;
      }
      label,
      div {
        user-select: none;
      }
      label,
      input {
        cursor: pointer;
      }
      label,
      div,
      input,
      textarea {
        font-size: 1rem;
      }
      input[type="text"],
      textarea {
        display: block;
        width: 100%;
        padding: 10px;
      }
      
      #container{
        display: flex;
        margin-bottom: 3rem;
      }
      #container > form{
        flex-grow: 1;
        margin-left: 2rem;
      }

      #bot{
        display:  flex;
      }
      
      #bot > *{
        min-width:  100px;
        margin-right:  2rem;
        border: 2px solid #ccc;
        padding: 0.5rem 1rem;
        background: #000;
        color: #fff;
      }
    </style>
  </head>
  <body>
    <div>
      <h1></h1>
    </div>
    <div id='container'>
      <section>
        <div id="commands"></div>
      </section>
      <form>
        <!--     script to run     -->
        <div id="scriptToRunContainer">
          <input
            id="singleScriptToUse"
            list="scriptToRunOptions"
            type="text"
            onchange="updateScript()"
            placeholder="Script To Run"
          />
          <datalist id="scriptToRunOptions"></datalist>
          <b>Script Type:</b>
          <select id='singleScriptType' onchange="updateScript()">
            <option value="test-live.sh" selected>Use Live Script</option>
            <option value="test.sh">Use Local Script</option>
          </select>
          <b>Debug Write To File:</b>
          <select id='debugWriteToFile' onchange="updateScript()">
            <option value="" selected>No</option>
            <option value="&& export DEBUG_WRITE_TO_HOME='1'">Yes</option>
           </select>
        </div>
        
        <!--     os to run     -->
        <div id='osToRunContainer'>
          <select id='osToRun' onchange="updateScript()">
            <option value="windows" selected>Windows with WSL</option>
            <option value="mac">Mac</option>
            <option value="android_termux">Android Termux</option>
            <option value="chrome_os">Chrome OS with Linux</option>
            <option value="ubuntu">Chrome OS with Linux</option>
            <option value="ming_64">Ming_64</option>
          </select>
        </div>
        
        <textarea
          id="output"
          placeholder="Output"
          readonly="true"
          onclick="selectCommands()"
        ></textarea>
      </form>
    </div>

    <div id='bot'>
      <a
        href="https://github.com/synle/bashrc"
        target="_blank"
        ><h3>.bashrc Repo</h3></a
      >

      <a
        href="https://github.com/synle/synle.github.io/blob/master/app/setup-bash-profile.html"
        target="_blank"
        ><h3>View Source</h3></a
      >
    </div>

    <script>
      let idx = Date.now();
      const configs = [
        {
          text: "Setup Dependencies",
          script: `. /dev/stdin <<< "$(curl -s https://raw.githubusercontent.com/synle/bashrc/master/setup-dependencies.sh)"`,
        },
        {
          text: "Setup Full Profile",
          script: `<OS_FLAGS> . /dev/stdin <<< "$(curl -s https://raw.githubusercontent.com/synle/bashrc/master/setup-full.sh?$(date +%s))"`,
          checked: true,
          shouldShowOsSelectionInput: true,
        },
        {
          text: "Setup Lightweight Profile",
          script: `. /dev/stdin <<< "$(curl -s https://raw.githubusercontent.com/synle/bashrc/master/setup-lightweight.sh?$(date +%s))"`,
        },
        {
          text: "Set up Chrome OS Linux",
          script: `
            . /dev/stdin <<< "$(curl -s https://raw.githubusercontent.com/synle/bashrc/master/install-dependencies-ubuntu.sh?$(date +%s))" &&
            . /dev/stdin <<< "$(curl -s https://raw.githubusercontent.com/synle/bashrc/master/install-dependencies-chrome-os-linux.sh?$(date +%s))"
          `
        },
        {
          text: "Setup etc Hosts",
          script: `curl -s https://raw.githubusercontent.com/synle/bashrc/master/setup-hosts.sh | sudo bash`,
        },
        {
          text: "Test Full Run live",
          script: `curl -s https://raw.githubusercontent.com/synle/bashrc/master/test-full-run-live.sh | bash`,
        },
        {
          text: "Test Single Script",
          script: `export TEST_SCRIPT_FILES="<SCRIPT_TO_RUN>" <DEBUG_WRITE_TO_HOME> && curl -s https://raw.githubusercontent.com/synle/bashrc/master/<SINGLE_SCRIPT_TO_RUN> | bash`,
          shouldShowScriptNameInput: true,
        },
      ].map((config) => ({
        idx: `command-option-${++idx}`,
        ...config,
      }));

      const configsByKey = {};
      for (const config of configs) {
        configsByKey[config.idx] = config;
      }

      async function init() {
        // available scripts
        let scriptToRunOptions = await fetch(
          `https://raw.githubusercontent.com/synle/bashrc/master/software/metadata/script-list.config`
        ).then((res) => res.text());
        scriptToRunOptions = scriptToRunOptions
          .split("\n")
          .map((s) => s.replace("./", "").trim())
          .filter((s) => !!s && (s.includes(".js") || s.includes(".sh")))
          .sort()
          .map((scriptName) => `<option>${scriptName}</option>`)
          .join("\n");
        document.querySelector(
          "#scriptToRunOptions"
        ).innerHTML = scriptToRunOptions;

        for (const config of configs) {
          const domCommand = document.createElement("div");
          domCommand.innerHTML = `
          <input onchange='updateScript()' type='radio' name='choice-setup' id='${
            config.idx
          }' value='${config.idx}' ${config.checked ? "checked" : ""} />
          <label for='${config.idx}'>${config.text}</label>
        `;
          document.querySelector("#commands").appendChild(domCommand);
        }

        updateScript();
      }

      function updateScript() {
        let newCommands = [];

        const selectedScriptIdx = document.querySelector(
          "[name='choice-setup']:checked"
        ).value;
        const selectedScript = configsByKey[selectedScriptIdx];
        const osFlag = document.querySelector('#osFlag').value.trim()

        newCommands.push(
          selectedScript.script.replace(
            "<SCRIPT_TO_RUN>",
            document.querySelector("#singleScriptToUse").value.trim()
          ).replace(
            "<DEBUG_WRITE_TO_HOME>",
            document.querySelector("#debugWriteToFile").value.trim()
          ).replace(
            "<SINGLE_SCRIPT_TO_RUN>",
            document.querySelector('#singleScriptType').value.trim()
          ).replace(
            "<OS_FLAGS>"
            `
              is_os_darwin_mac='${osFlag === "mac" ? "1" : "0"}'
              is_os_window='${osFlag === "windows" ? "1" : "0"}'
              is_os_ubuntu='${["windows","chrome_os","ubuntu"].indexOf(osFlag) >= 0 ? "1" : "0"}'
              is_os_chromeos='${osFlag === "chrome_os" ? "1" : "0"}'
              is_os_mingw64='${osFlag === "ming_64" ? "1" : "0"}'
              is_os_android_termux='${osFlag === "android_termux" ? "1" : "0"}'
            `.split('\n').map(r => r.trim()).join('\n')
          )
        );
        
        

        document.querySelector("#scriptToRunContainer").style.display = selectedScript.shouldShowScriptNameInput ? "block" : "none";
        document.querySelector("#osToRunContainer").style.display = selectedScript.shouldShowOsSelectionInput ? "block" : "none";
        document.querySelector("#output").value = newCommands.join("\n");
      }

      function selectCommands() {
        document.querySelector("#output").select();
        document.execCommand("copy");
      }

      init();
      
      // getting and setting the page title
      try {
        document.querySelector('h1').innerText = document.location.href.match(/[a-z-A-Z0-9]+\/[a-z-A-Z0-9]+.html/)[0].trim()
      } catch(err){}
    </script>
  </body>
</html>
