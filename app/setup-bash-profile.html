<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>synle/bashrc Setting up Bash Script</title>
    <style>
      html {
        font-family: Arial, Helvetica, sans-serif;
        font-size: 18px;
        padding: 10px 20px;
      }
      * {
        box-sizing: border-box;
      }
      #output {
        width: 100%;
        height: 300px;
        padding: 10px;
      }
      div {
        margin-bottom: 20px;
      }
      label,
      div {
        user-select: none;
      }
      label,
      input {
        cursor: pointer;
      }
      label,
      div,
      input,
      textarea {
        font-size: 1rem;
      }
      input[type="text"],
      textarea {
        display: block;
        width: 100%;
      }
      
      #container{
        display: flex;
        margin-bottom: 3rem;
      }
      #container > form{
        flex-grow: 1;
        margin-left: 2rem;
      }
    </style>
  </head>
  <body>
    <div>
      <h1>Set up Bash Profile</h1>
    </div>
    <div id='container'>
      <section>
        <div id="commands"></div>
      </section>
      <form>
        <div id="scriptToRun">
          <input
            list="scriptToRunOptions"
            type="text"
            onchange="updateScript()"
          />
          <datalist id="scriptToRunOptions"></datalist>
        </div>
        <textarea
          id="output"
          placeholder="Output"
          readonly="true"
          onclick="selectCommands()"
        ></textarea>
      </form>
    </div>

    <div style="margin-top: 10px">
      <a
        href="https://github.com/synle/bashrc"
        target="_blank"
        ><h3>.bashrc Repo</h3></a
      >

      <a
        href="https://github.com/synle/synle.github.io/blob/master/app/setup-bash-profile.html"
        target="_blank"
        ><h3>View Source</h3></a
      >
    </div>

    <script>
      let idx = Date.now();
      const configs = [
        {
          text: "Setup Dependencies",
          script: `. /dev/stdin <<< "$(curl -s https://raw.githubusercontent.com/synle/bashrc/master/setup-dependencies.sh)"`,
        },
        {
          text: "Setup Full Profile",
          script: `. /dev/stdin <<< "$(curl -s https://raw.githubusercontent.com/synle/bashrc/master/setup-full.sh?$(date +%s))"`,
          checked: true,
        },
        {
          text: "Setup Lightweight Profile",
          script: `. /dev/stdin <<< "$(curl -s https://raw.githubusercontent.com/synle/bashrc/master/setup-lightweight.sh?$(date +%s))"`,
        },
        {
          text: "Setup etc Hosts",
          script: `curl -s https://raw.githubusercontent.com/synle/bashrc/master/setup-hosts.sh | sudo bash`,
        },
        {
          text: "Test Full Run live",
          script: `curl -s https://raw.githubusercontent.com/synle/bashrc/master/test-full-run-live.sh | bash`,
        },
        {
          text: "Test Single Script Live",
          script: `export TEST_SCRIPT_FILES="<SCRIPT_TO_RUN>" && curl -s https://raw.githubusercontent.com/synle/bashrc/master/test-live.sh | bash`,
          shouldShowScriptNameInput: true,
        },
      ].map((config) => ({
        idx: `command-option-${++idx}`,
        ...config,
      }));

      const configsByKey = {};
      for (const config of configs) {
        configsByKey[config.idx] = config;
      }

      async function init() {
        // available scripts
        let scriptToRunOptions = await fetch(
          `https://raw.githubusercontent.com/synle/bashrc/master/software/metadata/script-list.config`
        ).then((res) => res.text());
        scriptToRunOptions = scriptToRunOptions
          .split("\n")
          .map((s) => s.replace("./", "").trim())
          .filter((s) => !!s && (s.includes(".js") || s.includes(".sh")))
          .sort()
          .map((scriptName) => `<option>${scriptName}</option>`)
          .join("\n");
        document.querySelector(
          "#scriptToRunOptions"
        ).innerHTML = scriptToRunOptions;

        for (const config of configs) {
          const domCommand = document.createElement("div");
          domCommand.innerHTML = `
          <input onchange='updateScript()' type='radio' name='choice-setup' id='${
            config.idx
          }' value='${config.idx}' ${config.checked ? "checked" : ""} />
          <label for='${config.idx}'>${config.text}</label>
        `;
          document.querySelector("#commands").appendChild(domCommand);
        }

        updateScript();
      }

      function updateScript() {
        let newCommands = [];

        const selectedScriptIdx = document.querySelector(
          "[name='choice-setup']:checked"
        ).value;
        const selectedScript = configsByKey[selectedScriptIdx];

        newCommands.push(
          selectedScript.script.replace(
            "<SCRIPT_TO_RUN>",
            document.querySelector("#scriptToRun").value
          )
        );

        if (selectedScript.shouldShowScriptNameInput) {
          document.querySelector("#scriptToRun").style.display = "block";
        } else {
          document.querySelector("#scriptToRun").style.display = "none";
        }

        document.querySelector("#output").value = newCommands.join("\n");
      }

      function selectCommands() {
        document.querySelector("#output").select();
        document.execCommand("copy");
      }

      init();
    </script>
  </body>
</html>
